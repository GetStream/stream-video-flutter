name: iOS Dogfooding â€” Pods & SPM

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build-ios:
    name: iOS Build (Dogfooding)
    runs-on: macos-latest

    steps:
      - name: ğŸ§° Setup Checkout
        uses: actions/checkout@v6

      - name: ğŸ› ï¸ Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: "stable"

      - name: ğŸ› ï¸ Setup FlutterFire CLI
        run: flutter pub global activate flutterfire_cli

      - name: ğŸ“¦ Deps flutter pub get
        run: flutter pub get

      - name: ğŸ« Pods Prepare (Flutter config + deps)
        working-directory: dogfooding
        run: |
          flutter config --no-enable-swift-package-manager
          flutter pub get

      - name: ğŸ« Pods Install
        working-directory: dogfooding/ios
        run: |
          pod repo update
          pod install

      - name: ğŸ—ï¸ Pods Build (no codesign)
        working-directory: dogfooding
        run: flutter build ios --no-codesign --verbose

      - name: ğŸ§¹ Clean Pods + caches
        working-directory: dogfooding
        run: |
          rm -rf ios/Pods ios/Podfile.lock
          flutter clean

      - name: ğŸ“¦ SPM Enable + Resolve
        working-directory: dogfooding
        run: |
          flutter config --enable-swift-package-manager
          flutter pub get

      - name: ğŸ§± SPM Build (no codesign)
        working-directory: dogfooding
        run: flutter build ios --no-codesign --verbose

      - name: âœ… Verify
        run: |
          echo "âœ… Both CocoaPods and SPM builds succeeded."
